<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="deudas.css">
    <title>Deudas</title>
</head>
<header>
    <h1>Control De Deudas</h1>
    <h3>Propias Y De Terceros</h3>
</header>
<body>
    <div class="contenedor">
    
    <div class="raya">
    <label for="deuda">Monto: </label>
    <input type="tel" name="" id="deuda">
    </div>
    
    <div class="raya">
    <label for="">Deuda: </label>
    <input type="text" list="tip" id="tipo">
    <datalist id="tip">
        <option value="propia"></option>
        <option value="de terceros"></option>
    </datalist>
    </div>

    <div class="raya">
    <label for="">Tarjeta: </label>
    <input type="text" list="tarje" id="tarjeta">
    <datalist id="tarje">
        <option value="Santander"></option>
        <option value="Mecardo pago"></option>
        <option value="BBVA"></option>
    </datalist>
    </div>
    
    <div class="raya">
    <label for="">Descrip.</label>
    <input type="text" id="descripcion">
    </div>

    <div class="raya">
    <button class="btn1" onclick="agregarDeuda()">Agregar</button>
    </div>
    <p>RESULTADO:</p>
    <div class="resultado">
    </div>
    
    <P>MONTO TOTAL DE TARJETAS:</P>
    <div class="conTar">
    </div>
        </div>

        <script>
            let resultado = JSON.parse(localStorage.getItem("resultado")) || [];
            
            function guardarDeuda(){
                localStorage.setItem("resultado",JSON.stringify(resultado));
            }

            function obtenerFecha(){
                const fecha = new Date();
                const dia = fecha.getDate();
                const mes = fecha.getMonth() + 1;
                const aÃ±o = fecha.getFullYear();
                return `${dia}/${mes}/${aÃ±o}`;
            }

            function renderDeuda(){
                const contendor = document.querySelector(".resultado");
                contendor.innerHTML =  "";
                
                resultado.forEach((item, index)=>{
                const p = document.createElement("p");

                p.innerHTML = `
                <input type="checkbox" ${item.completado ? "checked" : ""}
                    onchange = "toggleDeuda(${index})">

                    <span class="${item.completado ? 'completado' : ''}">El monto es: $${item.deuda} es cuenta ${item.tipo} con la tarjeta ${item.tarjeta}. DESCRIPCIÃ“N: ${item.descripcion} fecha:${obtenerFecha()}
                    </span>
                    
                        <div class="botones">
                        <button class = "btn" onclick="editarDeuda(${index})">âœï¸</button>
                        <button class = "btn" onclick="tipoDeuda(${index})">ğŸ‘¥</button>
                        <button class = "btn" onclick="tarjetaDeuda(${index})">ğŸ’³</button>
                        <button class = "btn" onclick="descripcionDeuda(${index})">ğŸ“</button>
                        <button class = "btn" onclick="borrarDeuda(${index})">ğŸ—‘ï¸</button>
                        <button class = "btn" onclick="abonoDeuda(${index})">ğŸ’²</button>

                        </div>
                        <br>
                `;
                contendor.appendChild(p);
                    });
            }

            //Agregar Una Deuda
            function agregarDeuda(){
                const deuda = document.getElementById("deuda").value;
                const tipo = document.getElementById("tipo").value;
                const tarjeta = document.getElementById("tarjeta").value;
                const descripcion = document.getElementById("descripcion").value;
                //const input = document.querySelector("input[type='tel']");//solo toma los inputs de tipo tel
                if(!deuda.trim())
                return;

                resultado.push({
                    deuda: Number(deuda), tipo, tarjeta, descripcion, completado:false
                });

                guardarDeuda();
                renderDeuda();
                renderTotales();
            }

            //Marcar o desmarcar una deuda
            function toggleDeuda(index){
                resultado[index].completado = !resultado[index].completado;
                guardarDeuda();
                renderDeuda();
            }

            //Eliminar Una Deuda
            function borrarDeuda(index){
                resultado.splice(index, 1);
                guardarDeuda();
                renderDeuda();
            }

            //Editar Una Deuda
            function editarDeuda(index){//edita el monto de la deuda
                const nuevo = prompt("Editar Deuda", Number(resultado[index].deuda));
                if(Number(nuevo)){
                    resultado[index].deuda = Number(nuevo);
                    guardarDeuda();
                    renderDeuda();
                    renderTotales();
                }
            }
            
            function tipoDeuda(index){//Editar tipo de deuda, si es propia o de terceros
                const nuevo = prompt("Editar Tipo de deuda", resultado[index].tipo);
                if(nuevo){
                    resultado[index].tipo = nuevo;
                    guardarDeuda();
                    renderDeuda();
                }
            }

            function tarjetaDeuda(index){//editar tipo de tarjeta
                const nuevo = prompt("Editar Tarjeta", resultado[index].tarjeta);
                if(nuevo){
                    resultado[index].tarjeta = nuevo;
                    guardarDeuda();
                    renderDeuda(); 
                }
            }

            function descripcionDeuda(index){//edita la descipcion
                const nuevo = prompt("Editar DescripciÃ³n", resultado[index].descripcion);
                if(nuevo){
                    resultado[index].descripcion = nuevo;
                    guardarDeuda();
                    renderDeuda();
                }
            }

            function abonoDeuda(index){//agrega un abono a la deuda y se resta del monto total
                const nuevo = prompt("Monto de abono", resultado[index].deuda);
                if(nuevo){
                    resultado[index].deuda -= Number(nuevo);
                    guardarDeuda();
                    renderDeuda();
                    renderTotales();
                }
            }
            function montoTarjetas(){
                const conTar = {};
                resultado.forEach(item =>{
                    if(!conTar[item.tarjeta]){
                        conTar[item.tarjeta] = 0;
                    }
                    conTar[item.tarjeta] += item.deuda;
                });
                return conTar;
            }
            guardarDeuda();
            renderTotales();

            function renderTotales(){
                const contenedor = document.querySelector(".conTar");
                contenedor.innerHTML = "";

                const conTar = montoTarjetas();

                for(const tarjeta in conTar){
                    const p = document.createElement("p");
                    p.textContent = `${tarjeta}: $${conTar[tarjeta]}`;
                    contenedor.appendChild(p);

                    guardarDeuda();
                    renderDeuda();
                }
            }

            renderDeuda();
            renderTotales();
        </script>
</body>
</html>
